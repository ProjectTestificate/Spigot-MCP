--- decompiled\net\minecraft\entity\ai\EntityAIRunAroundLikeCrazy.java
+++ src\main\java\net\minecraft\entity\ai\EntityAIRunAroundLikeCrazy.java
@@ -3,81 +3,78 @@
 import net.minecraft.entity.Entity;
 import net.minecraft.entity.passive.EntityHorse;
 import net.minecraft.entity.player.EntityPlayer;
 import net.minecraft.util.Vec3;
 
-public class EntityAIRunAroundLikeCrazy extends EntityAIBase
-{
+public class EntityAIRunAroundLikeCrazy extends EntityAIBase {
+
     private EntityHorse horseHost;
     private double field_111178_b;
     private double field_111179_c;
     private double field_111176_d;
     private double field_111177_e;
     private static final String __OBFID = "CL_00001612";
 
-    public EntityAIRunAroundLikeCrazy(EntityHorse p_i1653_1_, double p_i1653_2_)
-    {
+    public EntityAIRunAroundLikeCrazy(EntityHorse p_i1653_1_, double p_i1653_2_) {
         this.horseHost = p_i1653_1_;
         this.field_111178_b = p_i1653_2_;
         this.setMutexBits(1);
     }
 
-    public boolean shouldExecute()
-    {
-        if (!this.horseHost.isTame() && this.horseHost.riddenByEntity != null)
-        {
+    public boolean shouldExecute() {
+        if (!this.horseHost.isTame() && this.horseHost.riddenByEntity != null) {
             Vec3 vec3 = RandomPositionGenerator.findRandomTarget(this.horseHost, 5, 4);
 
-            if (vec3 == null)
-            {
+            if (vec3 == null) {
                 return false;
-            }
-            else
-            {
+            } else {
                 this.field_111179_c = vec3.xCoord;
                 this.field_111176_d = vec3.yCoord;
                 this.field_111177_e = vec3.zCoord;
                 return true;
             }
-        }
-        else
-        {
+        } else {
             return false;
         }
     }
 
-    public void startExecuting()
-    {
+    public void startExecuting() {
         this.horseHost.getNavigator().tryMoveToXYZ(this.field_111179_c, this.field_111176_d, this.field_111177_e, this.field_111178_b);
     }
 
-    public boolean continueExecuting()
-    {
+    public boolean continueExecuting() {
         return !this.horseHost.getNavigator().noPath() && this.horseHost.riddenByEntity != null;
     }
 
-    public void updateTask()
-    {
-        if (this.horseHost.getRNG().nextInt(50) == 0)
-        {
-            if (this.horseHost.riddenByEntity instanceof EntityPlayer)
-            {
+    public void updateTask() {
+        if (this.horseHost.getRNG().nextInt(50) == 0) {
+            if (this.horseHost.riddenByEntity instanceof EntityPlayer) {
                 int i = this.horseHost.getTemper();
                 int j = this.horseHost.getMaxTemper();
 
-                if (j > 0 && this.horseHost.getRNG().nextInt(j) < i)
-                {
-                    this.horseHost.setTamedBy((EntityPlayer)this.horseHost.riddenByEntity);
-                    this.horseHost.worldObj.setEntityState(this.horseHost, (byte)7);
+                // CraftBukkit - fire EntityTameEvent
+                if (j > 0 && this.horseHost.getRNG().nextInt(j) < i && !org.bukkit.craftbukkit.event.CraftEventFactory.callEntityTameEvent(this.horseHost, (EntityPlayer) this.horseHost.riddenByEntity).isCancelled() && this.horseHost.riddenByEntity instanceof EntityPlayer) {
+                    this.horseHost.setTamedBy((EntityPlayer) this.horseHost.riddenByEntity);
+                    this.horseHost.worldObj.setEntityState(this.horseHost, (byte) 7);
                     return;
                 }
 
                 this.horseHost.increaseTemper(5);
             }
 
-            this.horseHost.riddenByEntity.mountEntity((Entity)null);
+            this.horseHost.riddenByEntity.mountEntity((Entity) null);
             this.horseHost.riddenByEntity = null;
+            // CraftBukkit start - Handle dismounting to account for VehicleExitEvent being fired.
+            if (this.horseHost.riddenByEntity != null) {
+                this.horseHost.riddenByEntity.mountEntity((Entity) null);
+                // If the entity still has a passenger, then a plugin cancelled the event.
+                if (this.horseHost.riddenByEntity != null) {
+                    return;
+                }
+            }
+            // this.entity.passenger = null;
+            // CraftBukkit end
             this.horseHost.makeHorseRearWithSound();
-            this.horseHost.worldObj.setEntityState(this.horseHost, (byte)6);
+            this.horseHost.worldObj.setEntityState(this.horseHost, (byte) 6);
         }
     }
 }
